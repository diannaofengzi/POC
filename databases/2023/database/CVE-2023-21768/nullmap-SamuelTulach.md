# nullmap

Using CVE-2023-21768 to manual map kernel mode driver 

| Infos    | Value                                                              |
| -------- | -------------------------------------------------------------------|
| Username | [https://github.com/SamuelTulach](https://github.com/SamuelTulach) |
| Url      | [https://github.com/SamuelTulach/nullmap](https://github.com/SamuelTulach/nullmap)                                               |
| Stars    | 105                                                          |
| License  | No License                                                        |

<details>

<summary>Topic / Tags</summary>

* cve-2023-21768* driver* exploit* kernel* manual-mapper* mapper* windows

</details>

## Readme

# nullmap
A very simple driver manual mapper based on my older [voidmap](https://github.com/SamuelTulach/voidmap) and [CVE-2023-21768 POC](https://github.com/xforcered/Windows_LPE_AFD_CVE-2023-21768) by [chompie](https://twitter.com/chompie1337) and [b33f](https://twitter.com/FuzzySec). Because the underlying IoRing post-exploitation memory r/w primitive is not handling many consequent reads and writes very well, I've decided to overwrite CR4 to disable SMEP/SMAP to execute the driver mapped in usermode. Tested on Windows 11 22H2 (22621.525). 

Usage:
```
nullmap.exe <path_to_driver>
```

Possible problems:
- Manual mapped driver will be in a pool allocated by ExAllocatePool. If you want to use this for anything more serious you should consider finding a better way of memory allocation so it can't be dumped so easily.
- There is no easy way to read the original cr4 value which means that I had to hardcode the value that was there on my system. While it should be the same for most modern CPUs, you should still double-check that the value is correct.
- I've hard-coded offset to NtGdiGetEmbUFI since there is no easy way to sigscan it, which means that you will have to update this offset for your specific Windows build.
- It was written in one afternoon, it might not be the cleanest code base.

Video:

[![video](https://img.youtube.com/vi/qdAZ8mTsTrc/0.jpg)](https://www.youtube.com/watch?v=qdAZ8mTsTrc)



## Get the content

```
git clone https://github.com/SamuelTulach/nullmap
cd nullmap
```

{% embed url="https://github.com/SamuelTulach/nullmap" %}

<figure><img src="https://avatars.githubusercontent.com/u/16323119?v=4" alt=""><figcaption><p>SamuelTulach</p></figcaption></figure>
